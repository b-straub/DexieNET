/*
dexieNET.js

Copyright(c) 2023 Bernhard Straub

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

'DexieNET' used with permission of David Fahlander
*/
let _uiInteractions = {};
export function UnSubscribeJSObservable(disposable) {
    disposable.unsubscribe();
}
export function DotNetObservable(observable, action, dotnetRef, voidObservable = false) {
    return observable.subscribe({
        next: (v) => {
            if (voidObservable || v != undefined) {
                dotnetRef.invokeMethod('OnNext', action(v));
            }
        },
        error: (e) => dotnetRef.invokeMethod('OnError', e.message),
        complete: () => dotnetRef.invokeMethod('OnCompleted')
    });
}
// sync with DexieNETCloudUI.cs
export function SubscribeUserInteraction(db, dotnetRef) {
    const action = (res) => {
        var type = -1;
        const fieldType = (orgType) => {
            switch (orgType) {
                case 'text': return 0;
                case 'email': return 1;
                case 'otp': return 2;
                case 'password': return 3;
                default: throw "SubscribeUserInteraction, undefined field type!";
            }
        };
        var field = null;
        switch (res.type) {
            case 'email':
                type = 0;
                field = { type: fieldType(res.fields.email.type), label: null, placeholder: res.fields.email.placeholder };
                break;
            case 'otp':
                type = 1;
                field = { type: fieldType(res.fields.otp.type), label: res.fields.otp.label, placeholder: null };
                break;
            case 'message-alert':
                type = 2;
                field = null;
                break;
            case 'logout-confirmation':
                type = 3;
                field = null;
                break;
            default: throw "SubscribeUserInteraction, undefined ui type!";
        }
        const alerts = Array();
        res.alerts.forEach(alert => {
            var alertType = -1;
            switch (alert.type) {
                case 'info':
                    alertType = 0;
                    break;
                case 'warning':
                    alertType = 1;
                    break;
                case 'error':
                    alertType = 2;
                    break;
                default: throw "SubscribeUserInteraction, undefined alert type!";
            }
            var messageCode = -1;
            switch (alert.messageCode) {
                case 'OTP_SENT':
                    messageCode = 0;
                    break;
                case 'INVALID_OTP':
                    messageCode = 1;
                    break;
                case 'INVALID_EMAIL':
                    messageCode = 2;
                    break;
                case 'LICENSE_LIMIT_REACHED':
                    messageCode = 3;
                    break;
                case 'GENERIC_INFO':
                    messageCode = 4;
                    break;
                case 'GENERIC_WARNING':
                    messageCode = 5;
                    break;
                case 'GENERIC_ERROR':
                    messageCode = 6;
                    break;
                case 'LOGOUT_CONFIRMATION':
                    messageCode = 7;
                    break;
                default: throw "SubscribeUserInteraction, undefined message code!";
            }
            alerts.push({ type: alertType, code: messageCode, message: alert.message, params: alert.messageParams });
        });
        const key = Date.now();
        _uiInteractions[key] = res;
        return { type: type, title: res.title, alerts: alerts, fields: field, key: key };
    };
    return DotNetObservable(db.cloud.userInteraction, action, dotnetRef);
}
export function ClearUserInteraction() {
    _uiInteractions = {};
}
export function OnSubmitUserInteraction(key, params) {
    const uiInteraction = _uiInteractions[key];
    if (uiInteraction != undefined) {
        switch (uiInteraction.type) {
            case 'email':
                uiInteraction.onSubmit({ email: params['email'] });
                break;
            case 'otp':
                uiInteraction.onSubmit({ otp: params['otp'] });
                break;
            case 'message-alert':
                uiInteraction.onSubmit(params);
                break;
            default: throw "OnSubmitUserInteraction, undefined ui type!";
        }
        delete _uiInteractions[key];
    }
}
export function OnCancelUserInteraction(key) {
    const uiInteraction = _uiInteractions[key];
    if (uiInteraction != undefined) {
        uiInteraction.onCancel();
        delete _uiInteractions[key];
    }
}
export function SubscribeWebSocketStatus(db, dotnetRef) {
    const action = (res) => {
        return res;
    };
    return DotNetObservable(db.cloud.webSocketStatus, action, dotnetRef);
}
// sync with DexieNETSync.cs
export function SubscribeSyncState(db, dotnetRef) {
    const action = (res) => {
        const status = (orgType) => {
            switch (orgType) {
                case 'not-started': return 0;
                case 'connecting': return 1;
                case 'connected': return 2;
                case 'disconnected': return 3;
                case 'error': return 4;
                case 'offline': return 5;
                default: throw "SubscribeUserInteraction, undefined field type!";
            }
        };
        const phase = (orgType) => {
            switch (orgType) {
                case 'initial': return 0;
                case 'not-in-sync': return 1;
                case 'pushing': return 2;
                case 'pulling': return 3;
                case 'in-sync': return 4;
                case 'error': return 5;
                case 'offline': return 6;
                default: throw "SubscribeUserInteraction, undefined field type!";
            }
        };
        return { status: status(res.status), phase: phase(res.phase), progress: res.progress, error: res.error?.message };
    };
    return DotNetObservable(db.cloud.syncState, action, dotnetRef);
}
// sync with DexieNETSync.cs
export function SubscribePersistedSyncState(db, dotnetRef) {
    const action = (res) => {
        return res;
    };
    return DotNetObservable(db.cloud.persistedSyncState, action, dotnetRef);
}
export function SubscribeSyncComplete(db, dotnetRef) {
    const action = (_) => {
        return true;
    };
    return DotNetObservable(db.cloud.events.syncComplete, action, dotnetRef, true);
}
// sync with DexieNETCloudUser.cs
export function SubscribeUserLogin(db, dotnetRef) {
    const action = (res) => {
        let convert = (o) => Object.fromEntries(Object.keys(o).map(key => [key, o[key].toString()]));
        const licenseType = (orgType) => {
            switch (orgType) {
                case 'demo': return 0;
                case 'eval': return 1;
                case 'prod': return 2;
                case 'client': return 3;
                default: throw "SubscribeUserLogin, undefined license type!";
            }
        };
        const licenseStatus = (orgType) => {
            switch (orgType) {
                case 'ok': return 0;
                case 'expired': return 1;
                case 'deactivated': return 2;
                default: throw "SubscribeUserLogin, undefined license status!";
            }
        };
        let license = res.license === undefined ? undefined :
            {
                type: licenseType(res.license.type), status: licenseStatus(res.license.status),
                validUntil: res.license.validUntil, evalDaysLeft: res.license.evalDaysLeft
            };
        return {
            userId: res.userId, name: res.name, email: res.email, claims: convert(res.claims), license: license,
            lastlogin: res.lastLogin, accessToken: res.accessToken, accessTokenExpiration: res.accessTokenExpiration,
            refreshToken: res.refreshToken, refreshTokenExpiration: res.refreshTokenExpiration,
            nonExportablePrivateKey: JSON.stringify(res.nonExportablePrivateKey), publicKey: JSON.stringify(res.publicKey),
            isLoggedIn: res.isLoggedIn === undefined ? false : res.isLoggedIn
        };
    };
    return DotNetObservable(db.cloud.currentUser, action, dotnetRef);
}
// sync with DexieNETCloudAccesss.cs
let _invites = {};
export function SubscribeInvites(db, dotnetRef) {
    const action = (res) => {
        ClearInvites();
        res.forEach(i => _invites[i.id] = i);
        return res;
    };
    return DotNetObservable(db.cloud.invites, action, dotnetRef);
}
export function ClearInvites() {
    _invites = {};
}
export function AcceptInvite(key) {
    const invite = _invites[key];
    if (invite != undefined) {
        invite.accept();
    }
}
export function RejectInvite(key) {
    const invite = _invites[key];
    if (invite != undefined) {
        invite.reject();
    }
}
export function SubscribeRoles(db, dotnetRef) {
    const action = (res) => {
        return res;
    };
    return DotNetObservable(db.cloud.roles, action, dotnetRef);
}
let _permissionChecker = {};
export function SubscribePermissionChecker(db, dotnetRef, tableName, item) {
    const key = Date.now();
    item ??= { owner: undefined, realmId: undefined };
    const action = (res) => {
        _permissionChecker[key] = res;
        return key;
    };
    return DotNetObservable(db.cloud.permissions(item, tableName), action, dotnetRef);
}
export function ClearPermissionChecker(key) {
    if (_permissionChecker[key] != undefined) {
        delete _permissionChecker[key];
    }
}
export function PermissionCheckerAdd(key, ...tableNames) {
    const pc = _permissionChecker[key];
    if (pc != undefined) {
        return pc.add(...tableNames);
    }
    return false;
}
export function PermissionCheckerUpdate(key, ...keys) {
    const pc = _permissionChecker[key];
    if (pc != undefined) {
        return pc.update(...keys);
    }
    return false;
}
export function PermissionCheckerDelete(key) {
    const pc = _permissionChecker[key];
    if (pc != undefined) {
        return pc.delete();
    }
    return false;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV4aWVDbG91ZE5FVE9ic2VydmFibGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV4aWVDbG91ZE5FVE9ic2VydmFibGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7RUFrQkU7QUFXRixJQUFJLGVBQWUsR0FBMEMsRUFBRSxDQUFDO0FBRWhFLE1BQU0sVUFBVSx1QkFBdUIsQ0FBQyxVQUF3QjtJQUU1RCxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDN0IsQ0FBQztBQUVELE1BQU0sVUFBVSxnQkFBZ0IsQ0FBSSxVQUF5QixFQUFFLE1BQXlCLEVBQUUsU0FBYyxFQUFFLGlCQUEwQixLQUFLO0lBRXJJLE9BQU8sVUFBVSxDQUFDLFNBQVMsQ0FBQztRQUN4QixJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUNSLElBQUksY0FBYyxJQUFJLENBQUMsSUFBSSxTQUFTLEVBQUUsQ0FBQztnQkFDbkMsU0FBUyxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDL0MsQ0FBQztRQUNMLENBQUM7UUFDRCxLQUFLLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUM7UUFDMUQsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDO0tBQ3hELENBQUMsQ0FBQztBQUNQLENBQUM7QUFFRCwrQkFBK0I7QUFDL0IsTUFBTSxVQUFVLHdCQUF3QixDQUFDLEVBQVcsRUFBRSxTQUFjO0lBRWhFLE1BQU0sTUFBTSxHQUFHLENBQUMsR0FBdUIsRUFBRSxFQUFFO1FBQ3ZDLElBQUksSUFBSSxHQUFXLENBQUMsQ0FBQyxDQUFDO1FBRXRCLE1BQU0sU0FBUyxHQUFHLENBQUMsT0FBZSxFQUFVLEVBQUU7WUFDMUMsUUFBUSxP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dCI6WyIvKlxuZGV4aWVORVQuanNcblxuQ29weXJpZ2h0KGMpIDIwMjMgQmVybmhhcmQgU3RyYXViXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG4nRGV4aWVORVQnIHVzZWQgd2l0aCBwZXJtaXNzaW9uIG9mIERhdmlkIEZhaGxhbmRlciBcbiovXG5cbmltcG9ydCB7IENsb3VkREIgfSBmcm9tIFwiLi9kZXhpZUNsb3VkTkVUQmFzZVwiO1xuaW1wb3J0IHsgRFhDVXNlckludGVyYWN0aW9uIH0gZnJvbSBcImRleGllLWNsb3VkLWFkZG9uL2Rpc3QvbW9kZXJuL3R5cGVzL0RYQ1VzZXJJbnRlcmFjdGlvblwiO1xuaW1wb3J0IHsgU3luY1N0YXRlIH0gZnJvbSBcImRleGllLWNsb3VkLWFkZG9uL2Rpc3QvbW9kZXJuL3R5cGVzL1N5bmNTdGF0ZVwiO1xuaW1wb3J0IHsgVXNlckxvZ2luIH0gZnJvbSBcImRleGllLWNsb3VkLWFkZG9uL2Rpc3QvbW9kZXJuL2RiL2VudGl0aWVzL1VzZXJMb2dpblwiO1xuaW1wb3J0IHsgREJSZWFsbVJvbGUsIEludml0ZSB9IGZyb20gXCJkZXhpZS1jbG91ZC1hZGRvblwiO1xuaW1wb3J0IHsgUGVybWlzc2lvbkNoZWNrZXIgfSBmcm9tIFwiZGV4aWUtY2xvdWQtYWRkb24vZGlzdC9tb2Rlcm4vUGVybWlzc2lvbkNoZWNrZXJcIjtcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUGVyc2lzdGVkU3luY1N0YXRlIH0gZnJvbSBcImRleGllLWNsb3VkLWFkZG9uL2Rpc3QvbW9kZXJuL2RiL2VudGl0aWVzL1BlcnNpc3RlZFN5bmNTdGF0ZVwiO1xuXG5sZXQgX3VpSW50ZXJhY3Rpb25zOiB7IFtrZXk6IG51bWJlcl06IERYQ1VzZXJJbnRlcmFjdGlvbiB9ID0ge307XG5cbmV4cG9ydCBmdW5jdGlvbiBVblN1YnNjcmliZUpTT2JzZXJ2YWJsZShkaXNwb3NhYmxlOiBTdWJzY3JpcHRpb24pOiB2b2lkIHtcblxuICAgIGRpc3Bvc2FibGUudW5zdWJzY3JpYmUoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIERvdE5ldE9ic2VydmFibGU8VD4ob2JzZXJ2YWJsZTogT2JzZXJ2YWJsZTxUPiwgYWN0aW9uOiAoaW5wdXQ6IFQpID0+IGFueSwgZG90bmV0UmVmOiBhbnksIHZvaWRPYnNlcnZhYmxlOiBib29sZWFuID0gZmFsc2UpOiBTdWJzY3JpcHRpb24ge1xuXG4gICAgcmV0dXJuIG9ic2VydmFibGUuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKHYpID0+IHtcbiAgICAgICAgICAgIGlmICh2b2lkT2JzZXJ2YWJsZSB8fCB2ICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGRvdG5ldFJlZi5pbnZva2VNZXRob2QoJ09uTmV4dCcsIGFjdGlvbih2KSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IChlKSA9PiBkb3RuZXRSZWYuaW52b2tlTWV0aG9kKCdPbkVycm9yJywgZS5tZXNzYWdlKSxcbiAgICAgICAgY29tcGxldGU6ICgpID0+IGRvdG5ldFJlZi5pbnZva2VNZXRob2QoJ09uQ29tcGxldGVkJylcbiAgICB9KTtcbn1cblxuLy8gc3luYyB3aXRoIERleGllTkVUQ2xvdWRVSS5jc1xuZXhwb3J0IGZ1bmN0aW9uIFN1YnNjcmliZVVzZXJJbnRlcmFjdGlvbihkYjogQ2xvdWREQiwgZG90bmV0UmVmOiBhbnkpOiBTdWJzY3JpcHRpb24ge1xuXG4gICAgY29uc3QgYWN0aW9uID0gKHJlczogRFhDVXNlckludGVyYWN0aW9uKSA9PiB7XG4gICAgICAgIHZhciB0eXBlOiBudW1iZXIgPSAtMTtcblxuICAgICAgICBjb25zdCBmaWVsZFR5cGUgPSAob3JnVHlwZTogc3RyaW5nKTogbnVtYmVyID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAob3JnVHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3RleHQnOiByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICBjYXNlICdlbWFpbCc6IHJldHVybiAxO1xuICAgICAgICAgICAgICAgIGNhc2UgJ290cCc6IHJldHVybiAyO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3Bhc3N3b3JkJzogcmV0dXJuIDM7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgXCJTdWJzY3JpYmVVc2VySW50ZXJhY3Rpb24sIHVuZGVmaW5lZCBmaWVsZCB0eXBlIVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGZpZWxkOiB7IHR5cGU6IG51bWJlciwgbGFiZWw6IHN0cmluZyB8IG51bGwsIHBsYWNlaG9sZGVyOiBzdHJpbmcgfCBudWxsIH0gfCBudWxsID0gbnVsbDtcblxuICAgICAgICBzd2l0Y2ggKHJlcy50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdlbWFpbCc6XG4gICAgICAgICAgICAgICAgdHlwZSA9IDA7XG4gICAgICAgICAgICAgICAgZmllbGQgPSB7IHR5cGU6IGZpZWxkVHlwZShyZXMuZmllbGRzLmVtYWlsLnR5cGUpLCBsYWJlbDogbnVsbCwgcGxhY2Vob2xkZXI6IHJlcy5maWVsZHMuZW1haWwucGxhY2Vob2xkZXIgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ290cCc6XG4gICAgICAgICAgICAgICAgdHlwZSA9IDE7XG4gICAgICAgICAgICAgICAgZmllbGQgPSB7IHR5cGU6IGZpZWxkVHlwZShyZXMuZmllbGRzLm90cC50eXBlKSwgbGFiZWw6IHJlcy5maWVsZHMub3RwLmxhYmVsLCBwbGFjZWhvbGRlcjogbnVsbCB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdtZXNzYWdlLWFsZXJ0JzpcbiAgICAgICAgICAgICAgICB0eXBlID0gMjtcbiAgICAgICAgICAgICAgICBmaWVsZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdsb2dvdXQtY29uZmlybWF0aW9uJzpcbiAgICAgICAgICAgICAgICB0eXBlID0gMztcbiAgICAgICAgICAgICAgICBmaWVsZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OiB0aHJvdyBcIlN1YnNjcmliZVVzZXJJbnRlcmFjdGlvbiwgdW5kZWZpbmVkIHVpIHR5cGUhXCI7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhbGVydHMgPSBBcnJheTx7IHR5cGU6IG51bWJlciwgY29kZTogbnVtYmVyLCBtZXNzYWdlOiBzdHJpbmcsIHBhcmFtczogeyBbcGFyYW1OYW1lOiBzdHJpbmddOiBzdHJpbmcgfSB9PigpO1xuXG4gICAgICAgIHJlcy5hbGVydHMuZm9yRWFjaChhbGVydCA9PiB7XG4gICAgICAgICAgICB2YXIgYWxlcnRUeXBlOiBudW1iZXIgPSAtMTtcblxuICAgICAgICAgICAgc3dpdGNoIChhbGVydC50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnaW5mbyc6IGFsZXJ0VHlwZSA9IDA7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3dhcm5pbmcnOiBhbGVydFR5cGUgPSAxOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdlcnJvcic6IGFsZXJ0VHlwZSA9IDI7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRocm93IFwiU3Vic2NyaWJlVXNlckludGVyYWN0aW9uLCB1bmRlZmluZWQgYWxlcnQgdHlwZSFcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG1lc3NhZ2VDb2RlOiBudW1iZXIgPSAtMTtcblxuICAgICAgICAgICAgc3dpdGNoIChhbGVydC5tZXNzYWdlQ29kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ09UUF9TRU5UJzogbWVzc2FnZUNvZGUgPSAwOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdJTlZBTElEX09UUCc6IG1lc3NhZ2VDb2RlID0gMTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnSU5WQUxJRF9FTUFJTCc6IG1lc3NhZ2VDb2RlID0gMjsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnTElDRU5TRV9MSU1JVF9SRUFDSEVEJzogbWVzc2FnZUNvZGUgPSAzOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdHRU5FUklDX0lORk8nOiBtZXNzYWdlQ29kZSA9IDQ7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0dFTkVSSUNfV0FSTklORyc6IG1lc3NhZ2VDb2RlID0gNTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnR0VORVJJQ19FUlJPUic6IG1lc3NhZ2VDb2RlID0gNjsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnTE9HT1VUX0NPTkZJUk1BVElPTic6IG1lc3NhZ2VDb2RlID0gNzsgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgXCJTdWJzY3JpYmVVc2VySW50ZXJhY3Rpb24sIHVuZGVmaW5lZCBtZXNzYWdlIGNvZGUhXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFsZXJ0cy5wdXNoKHsgdHlwZTogYWxlcnRUeXBlLCBjb2RlOiBtZXNzYWdlQ29kZSwgbWVzc2FnZTogYWxlcnQubWVzc2FnZSwgcGFyYW1zOiBhbGVydC5tZXNzYWdlUGFyYW1zIH0pO1xuICAgICAgICB9KVxuXG4gICAgICAgIGNvbnN0IGtleSA9IERhdGUubm93KCk7XG4gICAgICAgIF91aUludGVyYWN0aW9uc1trZXldID0gcmVzO1xuXG4gICAgICAgIHJldHVybiB7IHR5cGU6IHR5cGUsIHRpdGxlOiByZXMudGl0bGUsIGFsZXJ0czogYWxlcnRzLCBmaWVsZHM6IGZpZWxkLCBrZXk6IGtleSB9O1xuICAgIH07XG5cbiAgICByZXR1cm4gRG90TmV0T2JzZXJ2YWJsZShkYi5jbG91ZC51c2VySW50ZXJhY3Rpb24sIGFjdGlvbiwgZG90bmV0UmVmKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIENsZWFyVXNlckludGVyYWN0aW9uKCk6IHZvaWQge1xuICAgIF91aUludGVyYWN0aW9ucyA9IHt9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gT25TdWJtaXRVc2VySW50ZXJhY3Rpb24oa2V5OiBudW1iZXIsIHBhcmFtczogeyBbcGFyYW1OYW1lOiBzdHJpbmddOiBzdHJpbmcgfSkge1xuXG4gICAgY29uc3QgdWlJbnRlcmFjdGlvbjogRFhDVXNlckludGVyYWN0aW9uID0gX3VpSW50ZXJhY3Rpb25zW2tleV07XG5cbiAgICBpZiAodWlJbnRlcmFjdGlvbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgc3dpdGNoICh1aUludGVyYWN0aW9uLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2VtYWlsJzpcbiAgICAgICAgICAgICAgICB1aUludGVyYWN0aW9uLm9uU3VibWl0KHsgZW1haWw6IHBhcmFtc1snZW1haWwnXSB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ290cCc6XG4gICAgICAgICAgICAgICAgdWlJbnRlcmFjdGlvbi5vblN1Ym1pdCh7IG90cDogcGFyYW1zWydvdHAnXSB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ21lc3NhZ2UtYWxlcnQnOlxuICAgICAgICAgICAgICAgIHVpSW50ZXJhY3Rpb24ub25TdWJtaXQocGFyYW1zKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6IHRocm93IFwiT25TdWJtaXRVc2VySW50ZXJhY3Rpb24sIHVuZGVmaW5lZCB1aSB0eXBlIVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgZGVsZXRlIF91aUludGVyYWN0aW9uc1trZXldO1xuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIE9uQ2FuY2VsVXNlckludGVyYWN0aW9uKGtleTogbnVtYmVyKSB7XG5cbiAgICBjb25zdCB1aUludGVyYWN0aW9uOiBEWENVc2VySW50ZXJhY3Rpb24gPSBfdWlJbnRlcmFjdGlvbnNba2V5XTtcblxuICAgIGlmICh1aUludGVyYWN0aW9uICE9IHVuZGVmaW5lZCkge1xuICAgICAgICB1aUludGVyYWN0aW9uLm9uQ2FuY2VsKCk7XG4gICAgICAgIGRlbGV0ZSBfdWlJbnRlcmFjdGlvbnNba2V5XTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBTdWJzY3JpYmVXZWJTb2NrZXRTdGF0dXMoZGI6IENsb3VkREIsIGRvdG5ldFJlZjogYW55KTogU3Vic2NyaXB0aW9uIHtcblxuICAgIGNvbnN0IGFjdGlvbiA9IChyZXM6IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH07XG5cbiAgICByZXR1cm4gRG90TmV0T2JzZXJ2YWJsZShkYi5jbG91ZC53ZWJTb2NrZXRTdGF0dXMsIGFjdGlvbiwgZG90bmV0UmVmKTtcbn1cblxuLy8gc3luYyB3aXRoIERleGllTkVUU3luYy5jc1xuZXhwb3J0IGZ1bmN0aW9uIFN1YnNjcmliZVN5bmNTdGF0ZShkYjogQ2xvdWREQiwgZG90bmV0UmVmOiBhbnkpOiBTdWJzY3JpcHRpb24ge1xuXG4gICAgY29uc3QgYWN0aW9uID0gKHJlczogU3luY1N0YXRlKSA9PiB7XG5cbiAgICAgICAgY29uc3Qgc3RhdHVzID0gKG9yZ1R5cGU6IHN0cmluZyk6IG51bWJlciA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKG9yZ1R5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdub3Qtc3RhcnRlZCc6IHJldHVybiAwO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2Nvbm5lY3RpbmcnOiByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICBjYXNlICdjb25uZWN0ZWQnOiByZXR1cm4gMjtcbiAgICAgICAgICAgICAgICBjYXNlICdkaXNjb25uZWN0ZWQnOiByZXR1cm4gMztcbiAgICAgICAgICAgICAgICBjYXNlICdlcnJvcic6IHJldHVybiA0O1xuICAgICAgICAgICAgICAgIGNhc2UgJ29mZmxpbmUnOiByZXR1cm4gNTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aHJvdyBcIlN1YnNjcmliZVVzZXJJbnRlcmFjdGlvbiwgdW5kZWZpbmVkIGZpZWxkIHR5cGUhXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwaGFzZSA9IChvcmdUeXBlOiBzdHJpbmcpOiBudW1iZXIgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChvcmdUeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnaW5pdGlhbCc6IHJldHVybiAwO1xuICAgICAgICAgICAgICAgIGNhc2UgJ25vdC1pbi1zeW5jJzogcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgY2FzZSAncHVzaGluZyc6IHJldHVybiAyO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3B1bGxpbmcnOiByZXR1cm4gMztcbiAgICAgICAgICAgICAgICBjYXNlICdpbi1zeW5jJzogcmV0dXJuIDQ7XG4gICAgICAgICAgICAgICAgY2FzZSAnZXJyb3InOiByZXR1cm4gNTtcbiAgICAgICAgICAgICAgICBjYXNlICdvZmZsaW5lJzogcmV0dXJuIDY7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgXCJTdWJzY3JpYmVVc2VySW50ZXJhY3Rpb24sIHVuZGVmaW5lZCBmaWVsZCB0eXBlIVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiBzdGF0dXMocmVzLnN0YXR1cyksIHBoYXNlOiBwaGFzZShyZXMucGhhc2UpLCBwcm9ncmVzczogcmVzLnByb2dyZXNzLCBlcnJvcjogcmVzLmVycm9yPy5tZXNzYWdlIH07XG4gICAgfTtcblxuICAgIHJldHVybiBEb3ROZXRPYnNlcnZhYmxlKGRiLmNsb3VkLnN5bmNTdGF0ZSwgYWN0aW9uLCBkb3RuZXRSZWYpO1xufVxuXG4vLyBzeW5jIHdpdGggRGV4aWVORVRTeW5jLmNzXG5leHBvcnQgZnVuY3Rpb24gU3Vic2NyaWJlUGVyc2lzdGVkU3luY1N0YXRlKGRiOiBDbG91ZERCLCBkb3RuZXRSZWY6IGFueSk6IFN1YnNjcmlwdGlvbiB7XG5cbiAgICBjb25zdCBhY3Rpb24gPSAocmVzOiBQZXJzaXN0ZWRTeW5jU3RhdGUpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIERvdE5ldE9ic2VydmFibGUoZGIuY2xvdWQucGVyc2lzdGVkU3luY1N0YXRlLCBhY3Rpb24sIGRvdG5ldFJlZik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBTdWJzY3JpYmVTeW5jQ29tcGxldGUoZGI6IENsb3VkREIsIGRvdG5ldFJlZjogYW55KTogU3Vic2NyaXB0aW9uIHtcblxuICAgIGNvbnN0IGFjdGlvbiA9IChfOiB2b2lkKSA9PiB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICByZXR1cm4gRG90TmV0T2JzZXJ2YWJsZShkYi5jbG91ZC5ldmVudHMuc3luY0NvbXBsZXRlLCBhY3Rpb24sIGRvdG5ldFJlZiwgdHJ1ZSk7XG59XG5cbi8vIHN5bmMgd2l0aCBEZXhpZU5FVENsb3VkVXNlci5jc1xuZXhwb3J0IGZ1bmN0aW9uIFN1YnNjcmliZVVzZXJMb2dpbihkYjogQ2xvdWREQiwgZG90bmV0UmVmOiBhbnkpOiBTdWJzY3JpcHRpb24ge1xuXG4gICAgY29uc3QgYWN0aW9uID0gKHJlczogVXNlckxvZ2luKSA9PiB7XG5cbiAgICAgICAgbGV0IGNvbnZlcnQgPSAobyA6IGFueSk6IGFueSA9PiBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmtleXMobykubWFwKGtleSA9PiBba2V5LCBvW2tleV0udG9TdHJpbmcoKV0pKTtcblxuICAgICAgICBjb25zdCBsaWNlbnNlVHlwZSA9IChvcmdUeXBlOiBzdHJpbmcpOiBudW1iZXIgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChvcmdUeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGVtbyc6IHJldHVybiAwO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2V2YWwnOiByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICBjYXNlICdwcm9kJzogcmV0dXJuIDI7XG4gICAgICAgICAgICAgICAgY2FzZSAnY2xpZW50JzogcmV0dXJuIDM7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgXCJTdWJzY3JpYmVVc2VyTG9naW4sIHVuZGVmaW5lZCBsaWNlbnNlIHR5cGUhXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBsaWNlbnNlU3RhdHVzID0gKG9yZ1R5cGU6IHN0cmluZyk6IG51bWJlciA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKG9yZ1R5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdvayc6IHJldHVybiAwO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2V4cGlyZWQnOiByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICBjYXNlICdkZWFjdGl2YXRlZCc6IHJldHVybiAyO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRocm93IFwiU3Vic2NyaWJlVXNlckxvZ2luLCB1bmRlZmluZWQgbGljZW5zZSBzdGF0dXMhXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbGljZW5zZSA9IHJlcy5saWNlbnNlID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6IGxpY2Vuc2VUeXBlKHJlcy5saWNlbnNlLnR5cGUpLCBzdGF0dXM6IGxpY2Vuc2VTdGF0dXMocmVzLmxpY2Vuc2Uuc3RhdHVzKSxcbiAgICAgICAgICAgICAgICB2YWxpZFVudGlsOiByZXMubGljZW5zZS52YWxpZFVudGlsLCBldmFsRGF5c0xlZnQ6IHJlcy5saWNlbnNlLmV2YWxEYXlzTGVmdFxuICAgICAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXNlcklkOiByZXMudXNlcklkLCBuYW1lOiByZXMubmFtZSwgZW1haWw6IHJlcy5lbWFpbCwgY2xhaW1zOiBjb252ZXJ0KHJlcy5jbGFpbXMpLCBsaWNlbnNlOiBsaWNlbnNlLFxuICAgICAgICAgICAgbGFzdGxvZ2luOiByZXMubGFzdExvZ2luLCBhY2Nlc3NUb2tlbjogcmVzLmFjY2Vzc1Rva2VuLCBhY2Nlc3NUb2tlbkV4cGlyYXRpb246IHJlcy5hY2Nlc3NUb2tlbkV4cGlyYXRpb24sXG4gICAgICAgICAgICByZWZyZXNoVG9rZW46IHJlcy5yZWZyZXNoVG9rZW4sIHJlZnJlc2hUb2tlbkV4cGlyYXRpb246IHJlcy5yZWZyZXNoVG9rZW5FeHBpcmF0aW9uLFxuICAgICAgICAgICAgbm9uRXhwb3J0YWJsZVByaXZhdGVLZXk6IEpTT04uc3RyaW5naWZ5KHJlcy5ub25FeHBvcnRhYmxlUHJpdmF0ZUtleSksIHB1YmxpY0tleTogSlNPTi5zdHJpbmdpZnkocmVzLnB1YmxpY0tleSksXG4gICAgICAgICAgICBpc0xvZ2dlZEluOiByZXMuaXNMb2dnZWRJbiA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiByZXMuaXNMb2dnZWRJblxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICByZXR1cm4gRG90TmV0T2JzZXJ2YWJsZShkYi5jbG91ZC5jdXJyZW50VXNlciwgYWN0aW9uLCBkb3RuZXRSZWYpO1xufVxuXG4vLyBzeW5jIHdpdGggRGV4aWVORVRDbG91ZEFjY2Vzc3MuY3NcbmxldCBfaW52aXRlczogeyBba2V5OiBzdHJpbmddOiBJbnZpdGUgfSA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gU3Vic2NyaWJlSW52aXRlcyhkYjogQ2xvdWREQiwgZG90bmV0UmVmOiBhbnkpOiBTdWJzY3JpcHRpb24ge1xuXG4gICAgY29uc3QgYWN0aW9uID0gKHJlczogSW52aXRlW10pID0+IHtcbiAgICAgICAgQ2xlYXJJbnZpdGVzKCk7XG4gICAgICAgIHJlcy5mb3JFYWNoKGkgPT4gX2ludml0ZXNbaS5pZF0gPSBpKTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIERvdE5ldE9ic2VydmFibGUoZGIuY2xvdWQuaW52aXRlcywgYWN0aW9uLCBkb3RuZXRSZWYpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gQ2xlYXJJbnZpdGVzKCk6IHZvaWQge1xuICAgIF9pbnZpdGVzID0ge307XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBBY2NlcHRJbnZpdGUoa2V5OiBzdHJpbmcpIHtcblxuICAgIGNvbnN0IGludml0ZTogSW52aXRlID0gX2ludml0ZXNba2V5XTtcblxuICAgIGlmIChpbnZpdGUgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGludml0ZS5hY2NlcHQoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBSZWplY3RJbnZpdGUoa2V5OiBzdHJpbmcpIHtcblxuICAgIGNvbnN0IGludml0ZTogSW52aXRlID0gX2ludml0ZXNba2V5XTtcblxuICAgIGlmIChpbnZpdGUgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGludml0ZS5yZWplY3QoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBTdWJzY3JpYmVSb2xlcyhkYjogQ2xvdWREQiwgZG90bmV0UmVmOiBhbnkpOiBTdWJzY3JpcHRpb24ge1xuXG4gICAgY29uc3QgYWN0aW9uID0gKHJlczoge1tyb2xlTmFtZTogc3RyaW5nXTogREJSZWFsbVJvbGV9KSA9PiB7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfTtcblxuICAgIHJldHVybiBEb3ROZXRPYnNlcnZhYmxlKGRiLmNsb3VkLnJvbGVzLCBhY3Rpb24sIGRvdG5ldFJlZik7XG59XG5cbmludGVyZmFjZSBORVRDbG91ZEVudGl0eSB7XG4gICAgb3duZXI/OiBzdHJpbmc7XG4gICAgcmVhbG1JZD86IHN0cmluZztcbn1cblxubGV0IF9wZXJtaXNzaW9uQ2hlY2tlcjogeyBba2V5OiBudW1iZXJdOiBQZXJtaXNzaW9uQ2hlY2tlcjxORVRDbG91ZEVudGl0eT4gfSA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gU3Vic2NyaWJlUGVybWlzc2lvbkNoZWNrZXIoZGI6IENsb3VkREIsIGRvdG5ldFJlZjogYW55LCB0YWJsZU5hbWU6IHN0cmluZywgaXRlbT86IE5FVENsb3VkRW50aXR5KTogU3Vic2NyaXB0aW9uIHtcblxuICAgIGNvbnN0IGtleSA9IERhdGUubm93KCk7XG4gICAgaXRlbSA/Pz0geyBvd25lcjogdW5kZWZpbmVkLCByZWFsbUlkOiB1bmRlZmluZWQgfTtcblxuICAgIGNvbnN0IGFjdGlvbiA9IChyZXM6IFBlcm1pc3Npb25DaGVja2VyPE5FVENsb3VkRW50aXR5LCBzdHJpbmc+KSA9PiB7XG4gICAgICAgIF9wZXJtaXNzaW9uQ2hlY2tlcltrZXldID0gcmVzO1xuICAgICAgICByZXR1cm4ga2V5O1xuICAgIH07XG5cbiAgICByZXR1cm4gRG90TmV0T2JzZXJ2YWJsZShkYi5jbG91ZC5wZXJtaXNzaW9ucyhpdGVtLCB0YWJsZU5hbWUpLCBhY3Rpb24sIGRvdG5ldFJlZik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBDbGVhclBlcm1pc3Npb25DaGVja2VyKGtleTogbnVtYmVyKTogdm9pZCB7XG5cbiAgICBpZiAoX3Blcm1pc3Npb25DaGVja2VyW2tleV0gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGRlbGV0ZSBfcGVybWlzc2lvbkNoZWNrZXJba2V5XTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBQZXJtaXNzaW9uQ2hlY2tlckFkZChrZXk6IHN0cmluZywgLi4udGFibGVOYW1lczogc3RyaW5nW10pOiBib29sZWFuIHtcblxuICAgIGNvbnN0IHBjOiBQZXJtaXNzaW9uQ2hlY2tlcjxhbnksIHN0cmluZz4gPSBfcGVybWlzc2lvbkNoZWNrZXJba2V5XTtcblxuICAgIGlmIChwYyAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHBjLmFkZCguLi50YWJsZU5hbWVzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBQZXJtaXNzaW9uQ2hlY2tlclVwZGF0ZShrZXk6IHN0cmluZywgLi4ua2V5czogc3RyaW5nW10pOiBib29sZWFuIHtcblxuICAgIGNvbnN0IHBjOiBQZXJtaXNzaW9uQ2hlY2tlcjxhbnksIHN0cmluZz4gPSBfcGVybWlzc2lvbkNoZWNrZXJba2V5XTtcblxuICAgIGlmIChwYyAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHBjLnVwZGF0ZSguLi5rZXlzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBQZXJtaXNzaW9uQ2hlY2tlckRlbGV0ZShrZXk6IHN0cmluZyk6IGJvb2xlYW4ge1xuXG4gICAgY29uc3QgcGM6IFBlcm1pc3Npb25DaGVja2VyPGFueSwgc3RyaW5nPiA9IF9wZXJtaXNzaW9uQ2hlY2tlcltrZXldO1xuXG4gICAgaWYgKHBjICE9IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gcGMuZGVsZXRlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xufSJdfQ==