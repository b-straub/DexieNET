@inherits RxBLComponent<ToDoItemService>

<MudCard Class="ma-8" Elevation="0" Outlined="true">
    <MudCardHeader>
        <CardHeaderAvatar>
            <MudAvatar Color="Color.Primary">
                <MudIcon Icon="@Icons.Material.Filled.MoreTime" />
            </MudAvatar>
        </CardHeaderAvatar>
        <CardHeaderContent>
            <MudText Typo="Typo.h6" GutterBottom="true">ToDo</MudText>
            @if (Service.CommandExceptions.Any())
            {
                <MudText Class="mt-4" Color="Color.Error">Error: @Service.CommandExceptions.FirstOrDefault()?.Message</MudText>
            }
        </CardHeaderContent>
        <CardHeaderActions>
            <MudHidden Breakpoint="Breakpoint.SmAndDown">
                <MudFabAsyncPRx Class="mr-2" Color="Color.Success" StartIcon="@Icons.Material.Filled.Add" Size="Size.Small" RxCommandAsyncFactory=@(() => Service.AddItem) PrepareExecutionAsync=@AddOrUpdate />
                <MudFabAsyncRx Color="Color.Error" StartIcon="@Icons.Material.Filled.AutoDelete" Size="Size.Small" ConfirmExecution=@(async () => await ConfirmDelete(DeleteType.Completed)) RxCommandAsyncFactory=@(() => Service.DeleteCompletedItems) />
                <MudFabAsyncRx Color="Color.Error" StartIcon="@Icons.Material.Filled.DeleteForever" Size="Size.Small" ConfirmExecution=@(async () => await ConfirmDelete(DeleteType.All)) RxCommandAsyncFactory=@(() => Service.ClearItems) />
            </MudHidden>
        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent>
        <MudHidden Breakpoint="Breakpoint.MdAndUp">
            <MudContainer Class="ml-n3 mb-8">
                <MudFabAsyncPRx Class="mr-2" Color="Color.Success" StartIcon="@Icons.Material.Filled.Add" Size="Size.Small" RxCommandAsyncFactory=@(() => Service.AddItem) PrepareExecutionAsync=@AddOrUpdate />
                <MudFabAsyncRx Color="Color.Error" StartIcon="@Icons.Material.Filled.AutoDelete" Size="Size.Small" ConfirmExecution=@(async () => await ConfirmDelete(DeleteType.Completed)) RxCommandAsyncFactory=@(() => Service.DeleteCompletedItems) />
                <MudFabAsyncRx Color="Color.Error" StartIcon="@Icons.Material.Filled.DeleteForever" Size="Size.Small" ConfirmExecution=@(async () => await ConfirmDelete(DeleteType.All)) RxCommandAsyncFactory=@(() => Service.ClearItems) />
            </MudContainer>
        </MudHidden>
        <MudTable T="ToDoDBItem" Items=@(Service.Lists) Dense="true">
            <ColGroup>
                <col style="width:55%;" />
                <col style="width:30%;" />
                <col style="width:5%;" />
                <col style="width:5%;" />
                <col style="width:5%;" />
            </ColGroup>
            <HeaderContent>
                <MudTh>ToDo</MudTh>
                <MudTh>
                    <MudTableSortLabel InitialDirection="SortDirection.Ascending" SortBy=@Sort() SortDirectionChanged=@(d => _sortDirection = d)>
                        DueDate
                    </MudTableSortLabel>
                </MudTh>
                <MudTh Style="text-align:center">
                    <MudIcon Icon="@Icons.Material.Filled.Check" />
                </MudTh>
                <MudTh Style="text-align:center">
                    <MudIcon Icon="@Icons.Material.Filled.Edit" />
                </MudTh>
                <MudTh Style="text-align:center">
                    <MudIcon Color="Color.Error" Icon="@Icons.Material.Filled.Delete" />
                </MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="ToDo"><MudText Style=@ColorForItem(context)>@context.Text</MudText></MudTd>
                <MudTd DataLabel="DueDate"><MudText Style=@ColorForItem(context)>@DateTimeForItem(context)</MudText></MudTd>
                <MudTd DataLabel="Completed" Style="text-align:center">
                    <MudIconButtonAsyncPRx Icon=@(context.Completed ? Icons.Material.Filled.CheckBox : Icons.Material.Filled.CheckBoxOutlineBlank) Parameter=@context RxCommandAsyncFactory=@(() => Service.ToggledItemCompleted) />
                </MudTd>
                <MudTd DataLabel="Edit" Style="text-align:center">
                    <MudIconButtonAsyncPRx Color="Color.Info" Icon=@Icons.Material.Filled.Edit RxCommandAsyncFactory=@(() => Service.UpdateItem) Parameter=@context PrepareExecutionAsync=@AddOrUpdate />
                </MudTd>
                <MudTd DataLabel="DeleteItem" Style="text-align:center">
                    <MudIconButtonAsyncPRx Color="Color.Error" Icon=@Icons.Material.Filled.Delete RxCommandAsyncFactory=@(() => Service.DeleteItem) Parameter=@context ConfirmExecution=@(async () => await ConfirmDelete(DeleteType.One)) />
                </MudTd>
            </RowTemplate>
        </MudTable>
    </MudCardContent>
</MudCard>